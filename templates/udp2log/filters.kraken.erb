# Note: This file is managed by Puppet.

<%
# quick and easy method for DRYing piping into kafka producer.
def kafka_producer(topic)
  "/usr/lib/kafka/bin/kafka-producer-shell.sh --props=/etc/kafka/producer.properties --topic=#{topic} > /dev/null"
end
-%>

# Note:  packet-loss is not debianize or puppetized.
# I have manually copied it into /usr/local/bin. - otto

# udp2log packet loss monitoring
pipe 10 /usr/local/bin/packet-loss 10 >> /var/log/udp2log/kraken/packet-loss.log

# Produce logs into Kafka:

# pipe English language Wikipedia logs into Kafka Topic en-wikipedia
pipe 1 /usr/bin/udp-filter -d en.wikipedia.org -p /wiki/ | <%= kafka_producer("en-wikipedia") %>

# banner logs for Jeff and fundraising
pipe 1 /usr/bin/udp-filter -p Special:RecordImpression\?banner=,Special:RecordImpression\?result= | <%= kafka_producer("fr-banner") %>
